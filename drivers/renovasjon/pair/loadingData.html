<script type="application/javascript">
  Homey.setTitle(Homey.__("pair.title"));
  Homey.setSubtitle(Homey.__("pair.loading.desc"));
</script>
<style>
  button {
    max-width: 404px;
    max-height: 48px;
  }

  .nav-footer {
    bottom: 0;
    left: 0;
    width: 420px;
    height: 64px;
    display: flex;
    justify-content: center;
    align-items: center;
    position: fixed;
  }
</style>
<header class="homey-header">
  <h1 class="homey-title">
    <!-- This will be filled with the translated string with key 'settings.title'. -->
  </h1>
  <p class="homey-subtitle">
    <!-- This will be filled with the translated string with key 'settings.subtitle'. -->
  </p>
</header>

<body>
  <div class="homey-form-group">
    <div align="center" id="showLoadingData"></div>
  </div>
  <div align="center" id="showResultData" style="display: none;">
    <div id="resultData"></div>
    <h5 class="homey-title">Feil leverandør?</h5>
    <p class="homey-subtitle">Velg riktig leverandør under, og trykk på knappen</p>
    <select class="homey-form-select" id="provider">
      <option value="">Velg leverandør</option>
      <!-- Avfall Sør -->
      <option value="Avfall Sør">Avfall Sør</option>
      <!-- BIR -->
      <option value="BIR">BIR</option>
      <!-- Glør -->
      <option value="Glør">Glør</option>
      <!-- Innherred Renovasjon -->
      <option value="Innherred Renovasjon">Innherred Renovasjon</option>
      <!-- Min renovasjon -->
      <option value="Min renovasjon">Min renovasjon</option>
      <!-- Oslo kommune -->
      <option value="Oslo kommune">Oslo kommune</option>
      <!-- ReMidt -->
      <option value="ReMidt">ReMidt</option>
      <!-- Stavanger kommune -->
      <option value="Stavanger kommune">Stavanger kommune</option>
    </select>
  </div>
</body>
<nav class="nav-footer">
  <button class="homey-button-primary-shadow-full is-disabled" id="providerButton"
    onclick="changeProvider();">Neste</button>
</nav>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>
<script type="application/javascript">
  const button = document.getElementById("providerButton");
  const resultData = document.getElementById("showResultData");

  Homey.on("reno", function (message) {
    const currentText = document.getElementById("showLoadingData").innerHTML;
    const newText = `${currentText}${message}<br>`;
    document.getElementById("showLoadingData").innerHTML = message;
  });

  Homey.on("renoResult", function (data) {
    $('#showResultData').show();
    $('#showLoadingData').hide();
    let resultHTML = "";
    console.log(data);
    button.classList.remove("is-disabled");
    for (const [addressData] of Object.entries(data)) {
      const { provider, address, id } = addressData;
      resultHTML += `Hurra! Vi fant en tømmekalender for ${address}<br>`;
      resultHTML += `AddresseID: ${id}<br>`;
      resultHTML += `Leverandør: ${provider}<br><br>`;
    }
    document.getElementById("resultData").innerHTML = resultHTML;
  });

  function changeProvider() {
    const provider = document.getElementById("provider").value;
    if (provider === "") {
      Homey.nextView();
      return;
    }
    button.innerHTML = "Laster inn...";
    button.classList.add("is-loading");
    console.log(provider);
    //document.getElementById("showResultData").innerHTML += `<br>${provider}`;
    Homey.emit("changeProvider", provider);
  };
</script>